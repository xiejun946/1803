2018-10-12
绑定域名基本步骤
基本现有架构，一套代码，绑定不同不同站点多个域名，在apache服务器上面通过ServerAlias语句，nginx服务器上面通过servername语句
1首先进入ansible管理主机有2台，易彩和博友，绑定相应的站点域名，进入对应的管理主机操作。修改apache和nginx配置文件，然后同步到所有apache和nginx服务器，
支付域名也是一样的方法来绑定，然后利用ansible重启apache和nginx
2进入fikker相应的站点添加域名
3修改dsn，注意是json格式，因为dsn是hash表类型

                                              开通站点步骤流程
 进入fikker主控新增套餐，然后用用client账号登录主控客户端购买对应套餐，添加对应站点的域名以及支付域名到w47.yczhifu.com到支付域名组
 第二步，进入dns盾，添加fikker主机的域名cname，例如w57.googleecdn.com 
                   支付域名例如w57.yczhifu.com不用添加，因为有泛解析，都是一个借口
                   后台域名yicaiadmin.com额外添加一条cname，主机名取一个好记的名字即可
 第三步，也是最重要的数据库备份，还原以temple为模块，redis备份还原，根据情况是新建数据库还是和其他站点一起公用私库，公库不用管，程序里面会自动调用
 第四步  进入博友或者易彩的ansbile主机，添加站点域名到apache和nginx配置文件，注意，域名是h5还是pc的，配置文件不一样。修改配置文件后，同步到
         apache和nginx群组web服务器，然后重新加载即可，这里可以利用history查看之前的命令
 第五步进入redis或者一键dsn网站修改对应的dsn，添加例如w57
                                                  w57.yczhifu.com
                                                  后台域名
                                                  站点域名
 注意json格式即可，这里dsn里面即第三步的数据库账号密码，redis域名，注意这里可以使mycat的域名账号密码
  第六步，注意数据库中gc_set_domain中添加支付域名和站点域名w57.yczhifu.com,结算服务器，老的需要添加代理报表计划任务，新的易彩需要添加结算的计划任务


                               开奖未结算
     进入易彩或者博友的结算服务器，查看history或者crontab计划任务，运行php脚本
     开奖未结算手动结算
sudo php /home/git/gcapi/user/index.php syssettlement index a26 bj28 914071
sudo php /home/git/gcapi/user/index.php syssettlement index w31 s_bjpk10 708028


工作中如果需要临时修改私库gcset字段的时候，要进入对应的私库redis中，4库是私库，删除gcget这个kv值
修改杀率即中奖率，需要修改对应私库中的gcset表中winrate值，然后清理对应redis私库的gcset值




                                   主PC和手机域名
 在超级后台，域名管理中可以添加主，PC和手机域名，当电脑中输入了手机的域名，会跳转到对应的主PC域名，手机输入了电脑域名，也会跳转到主手机域名                                  
